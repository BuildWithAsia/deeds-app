<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deeds | Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css"
      integrity="sha384-4VhpjS/4jGouVp21Hb+Jseb3CidRubc4QpfAlWTMwVzKhI6+w4n1vCtbmZh9rqxW"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../styles.css" />
    <style>
      .admin-theme {
        background: linear-gradient(to bottom right, #faf5ff, #ffffff, #f3e8ff);
      }
      .admin-accent {
        background-color: #7c3aed;
      }
      .admin-accent-hover:hover {
        background-color: #6d28d9;
      }
      .admin-badge {
        background-color: #7c3aed;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div class="min-h-screen admin-theme">
      <header class="border-b border-purple-200 bg-white/90 backdrop-blur">
        <div class="mx-auto flex max-w-6xl flex-col gap-4 px-6 py-5">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <a
              href="dashboard.html"
              class="flex items-center gap-2 text-lg font-semibold text-slate-900"
            >
              <span
                class="inline-flex h-9 w-9 items-center justify-center rounded-full admin-accent text-white"
                aria-hidden="true"
                >D</span
              >
              <span>Deeds</span>
              <span class="admin-badge">Admin</span>
            </a>
            <nav
              class="flex flex-wrap items-center gap-4 text-sm text-slate-600"
            >
              <a
                href="verify.html"
                class="hover:text-purple-700"
                >Verification Queue</a
              >
              <a
                href="../dashboard.html"
                class="hover:text-purple-700"
                >User View</a
              >
              <a
                href="../leaderboard.html"
                class="hover:text-purple-700"
                >Leaderboard</a
              >
            </nav>
            <button
              type="button"
              class="inline-flex items-center justify-center rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 shadow-sm transition hover:border-purple-600 hover:text-purple-700"
              data-action="logout"
            >
              Log out
            </button>
          </div>
        </div>
      </header>

      <main class="mx-auto max-w-6xl px-6 py-8">
        <!-- Welcome Section -->
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-slate-900 mb-2">
            Admin Dashboard
          </h1>
          <p class="text-slate-600">
            Manage deeds verification, view analytics, and oversee community activity.
          </p>
        </div>

        <!-- Stats Overview -->
        <div class="grid gap-6 md:grid-cols-3 mb-8">
          <!-- Pending Deeds -->
          <div class="rounded-xl border border-purple-200 bg-white p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm font-semibold text-slate-600">Pending Deeds</h3>
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-amber-100 text-amber-700">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </span>
            </div>
            <p class="text-3xl font-bold text-slate-900" data-stat="pending">-</p>
            <p class="mt-2 text-sm text-slate-500">Awaiting verification</p>
          </div>

          <!-- Total Verified -->
          <div class="rounded-xl border border-purple-200 bg-white p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm font-semibold text-slate-600">Verified Deeds</h3>
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-teal-100 text-teal-700">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </span>
            </div>
            <p class="text-3xl font-bold text-slate-900" data-stat="verified">-</p>
            <p class="mt-2 text-sm text-slate-500">Total approved</p>
          </div>

          <!-- Total Users -->
          <div class="rounded-xl border border-purple-200 bg-white p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm font-semibold text-slate-600">Active Users</h3>
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-purple-100 text-purple-700">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              </span>
            </div>
            <p class="text-3xl font-bold text-slate-900" data-stat="users">-</p>
            <p class="mt-2 text-sm text-slate-500">Community members</p>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid gap-6 md:grid-cols-2 mb-8">
          <!-- Verification Queue -->
          <a
            href="verify.html"
            class="block rounded-xl border border-purple-200 bg-white p-6 shadow-sm transition hover:border-purple-400 hover:shadow-md"
          >
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-slate-900">Verification Queue</h3>
              <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
            <p class="text-slate-600 mb-4">
              Review and approve pending deed submissions from community members.
            </p>
            <span class="inline-flex items-center gap-2 text-sm font-semibold text-purple-700">
              <span data-stat="pending">0</span> deeds pending
            </span>
          </a>

          <!-- Analytics -->
          <div class="rounded-xl border border-purple-200 bg-white p-6 shadow-sm opacity-60">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-slate-900">Analytics</h3>
              <span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded">Coming Soon</span>
            </div>
            <p class="text-slate-600 mb-4">
              View detailed reports on community engagement, verification trends, and impact metrics.
            </p>
            <span class="text-sm text-slate-500">
              Feature in development
            </span>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="rounded-xl border border-purple-200 bg-white p-6 shadow-sm">
          <h3 class="text-lg font-semibold text-slate-900 mb-4">Recent Deeds</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
              <thead>
                <tr class="text-left text-sm text-slate-600">
                  <th class="pb-3 font-semibold">Deed</th>
                  <th class="pb-3 font-semibold">User</th>
                  <th class="pb-3 font-semibold">Status</th>
                  <th class="pb-3 font-semibold">Submitted</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-100" data-recent-deeds>
                <tr>
                  <td colspan="4" class="py-8 text-center text-slate-500">
                    Loading recent activity...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <script src="../script.js" defer></script>
    <script>
      // Admin dashboard logic
      async function loadAdminStats() {
        try {
          // Fetch all deeds
          const deedsResponse = await fetch('/api/deeds');
          const deeds = await deedsResponse.json();

          // Fetch leaderboard for user count
          const leaderboardResponse = await fetch('/api/leaderboard');
          const users = await leaderboardResponse.json();

          // Calculate stats
          const pending = deeds.filter(d => d.status === 'pending').length;
          const verified = deeds.filter(d => d.status === 'verified').length;
          const userCount = users.length;

          // Update stats
          document.querySelectorAll('[data-stat="pending"]').forEach(el => {
            el.textContent = pending;
          });
          document.querySelectorAll('[data-stat="verified"]').forEach(el => {
            el.textContent = verified;
          });
          document.querySelectorAll('[data-stat="users"]').forEach(el => {
            el.textContent = userCount;
          });

          // Render recent deeds
          renderRecentDeeds(deeds.slice(0, 10));
        } catch (error) {
          console.error('Failed to load admin stats:', error);
        }
      }

      function renderRecentDeeds(deeds) {
        const tbody = document.querySelector('[data-recent-deeds]');
        if (!tbody || !deeds.length) return;

        tbody.innerHTML = deeds.map(deed => `
          <tr class="text-sm">
            <td class="py-3 font-medium text-slate-900">${deed.title}</td>
            <td class="py-3 text-slate-600">${deed.user_name}</td>
            <td class="py-3">
              <span class="inline-flex rounded-full px-2 py-1 text-xs font-semibold ${
                deed.status === 'verified'
                  ? 'bg-teal-100 text-teal-700'
                  : 'bg-amber-100 text-amber-700'
              }">
                ${deed.status}
              </span>
            </td>
            <td class="py-3 text-slate-500">${new Date(deed.created_at).toLocaleDateString()}</td>
          </tr>
        `).join('');
      }

      // Load stats on page load
      document.addEventListener('DOMContentLoaded', loadAdminStats);
    </script>
  </body>
</html>
